<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
    <title>Otaku Beads | Google Driven</title>
    <script src="https://accounts.google.com/gsi/client" async defer></script>
    <script src="https://pay.google.com/gp/p/js/pay.js" async defer></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Rounded:opsz,wght,FILL,GRAD@24,400,0..1,0" rel="stylesheet">
    <style>
        :root { --bg: #0F0D13; --card: #1C1921; --prim: #D0BCFF; --on-prim: #381E72; --out: #49454F; --sheet: #25232A; --surf: #2B2930; }
        body { font-family: 'Outfit', sans-serif; background: var(--bg); color: #E6E1E5; margin: 0; padding-bottom: 120px; }
        .sheet-content { width: 100%; background: var(--sheet); border-radius: 32px 32px 0 0; height: 92vh; display: flex; flex-direction: column; overflow: hidden; position: fixed; bottom: 0; z-index: 10000; transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1); transform: translateY(100%); }
        .sheet-content.active { transform: translateY(0); }
        .promo-box { background: var(--surf); padding: 16px; border-radius: 20px; margin-bottom: 20px; border: 1px solid var(--out); }
        .promo-input { width: 100%; background: transparent; border: none; color: white; outline: none; font-size: 14px; padding-top: 8px; }
    </style>
</head>
<body>
    <div id="checkout-sheet" class="sheet-content">
        <div style="padding:24px; flex:1; overflow-y:auto;">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:24px;">
                <h2 style="margin:0;">Your Bag</h2>
                <span class="material-symbols-rounded" onclick="UI.toggleCart()">close</span>
            </div>
            
            <div id="cart-items-list"></div>

            <div class="promo-box">
                <small style="color:var(--prim); font-weight:700;">PROMO CODE</small>
                <input type="text" class="promo-input" placeholder="Paste Soul-Bound code here..." oninput="ENGINE.applyPromo(this.value)">
            </div>
            
            </div>
        <div style="padding:24px; background:var(--card); border-top:1px solid var(--out);">
            <div style="display:flex; justify-content:space-between; margin-bottom:16px;">
                <b>Total (ZAR)</b>
                <b id="final-total" style="color:var(--prim); font-size:24px;">R0</b>
            </div>
            <div id="gpay-btn-container"></div>
        </div>
    </div>

    <script>
        const ENGINE = {
            // Updated to ensure all names in bag are clean
            updateUI() {
                const list = document.getElementById('cart-items-list');
                list.innerHTML = Object.keys(this.cart).map(key => {
                    const cleanName = key.split('.')[0].replace(/_/g, ' ');
                    return `<div style="display:flex; justify-content:space-between; margin-bottom:12px;">
                        <span>${cleanName} x${this.cart[key].qty}</span>
                        <b>R${this.cart[key].p * this.cart[key].qty}</b>
                    </div>`;
                }).join('');
                // Total and Discount calculations offloaded to Google processing logic
            }
        };
    </script>
</body>
</html>
