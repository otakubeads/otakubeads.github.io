<style>
    .save-toggle { display: flex; align-items: center; gap: 12px; margin-top: 12px; font-size: 14px; color: var(--prim); cursor: pointer; }
    .m3-chip-sm { padding: 6px 12px; border-radius: 8px; background: var(--out); font-size: 11px; font-weight: 700; }
</style>

<div id="account-overlay" class="sheet-overlay" onclick="UI.close('account')">
    <div class="sheet-content" onclick="event.stopPropagation()">
        <div class="sheet-body">
            <div id="logged-in-view" style="display:none;">
                <div id="user-avatar-large"></div>
                <h2 id="user-name-display"></h2>
                
                <div style="margin-top:32px; text-align:left; background:rgba(255,255,255,0.03); padding:20px; border-radius:24px;">
                    <p style="font-weight:700; margin:0 0 12px 0;">Delivery Preferences âš“</p>
                    <div style="display:flex; justify-content:space-between; align-items:center;">
                        <span id="saved-paxi-label" style="opacity:0.7;">No saved PAXI point</span>
                        <button onclick="ENGINE.clearSavedPaxi()" style="color:var(--err); background:none; border:none; font-size:12px;">Clear</button>
                    </div>
                </div>
                
                <button class="btn-m3" style="margin-top:32px; background:var(--out); color:var(--err);" onclick="UI.logout()">Sign Out</button>
            </div>
        </div>
    </div>
</div>

<script>
    const ENGINE = {
        // ... previous logic ...
        savedPaxi: localStorage.getItem('otaku_saved_paxi') || '',
        
        init() {
            // ... inventory load ...
            this.syncUser();
            this.refreshSavedLabel();
        },
        
        refreshSavedLabel() {
            const label = document.getElementById('saved-paxi-label');
            if(label) label.innerText = this.savedPaxi ? `Saved: ${this.savedPaxi}` : 'No saved PAXI point';
            if(this.savedPaxi && document.getElementById('paxi-point-code')) {
                document.getElementById('paxi-point-code').value = this.savedPaxi;
            }
        },

        setPaxi(price, name) {
            this.paxiPrice = price;
            this.paxiName = name;
            document.querySelectorAll('.paxi-chip').forEach(c => c.classList.remove('active'));
            document.getElementById(`paxi-${price}`).classList.add('active');
            
            const box = document.getElementById('paxi-code-box');
            box.style.display = price === 0 ? 'none' : 'block';
            
            // Auto-fill if we have it
            if(price !== 0 && this.savedPaxi) {
                document.getElementById('paxi-point-code').value = this.savedPaxi;
            }
            this.update();
        },

        clearSavedPaxi() {
            localStorage.removeItem('otaku_saved_paxi');
            this.savedPaxi = '';
            this.refreshSavedLabel();
            alert("Delivery info cleared.");
        },

        sendWhatsApp() {
            const codeInput = document.getElementById('paxi-point-code').value;
            const shouldSave = document.getElementById('save-paxi-check')?.checked;
            
            if(shouldSave && codeInput) {
                localStorage.setItem('otaku_saved_paxi', codeInput);
                this.savedPaxi = codeInput;
            }
            
            // ... WhatsApp message logic ...
        }
    };
</script>
