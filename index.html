
				        };

        const ENGINE = {
            cart: JSON.parse(localStorage.getItem('otaku_cart_v2') || '{}'),
            inventory: ["Akane_keychain.jpg", "Ryomen_keychain.jpg", "Bulma_bracelet.jpg", "Usopp.jpg", "Chi-Chi_bracelet.jpg", "Vageta_bracelet.jpg", "Dengi_keychain.jpg", "Yuta_keychain.jpg", "Gojo_keychain.jpg", "Zoro_bracelet.jpg", "Goku_bracelet.jpg", "Inosuke_keychain.jpg", "Kento_keychain.jpg", "Luffy_bracelet.jpg", "Nami_bracelet.jpg", "Nezuko_keychain.jpg", "Pwr_Moewy_keychain.jpg", "Ranma_keychain.jpg", "Ryoga_keychain.jpg"],
            init() {
                const grid = document.getElementById('store-grid');
                grid.innerHTML = this.inventory.map(file => {
                    const type = file.toLowerCase().includes('keychain') ? 'Keychain' : 'Bracelet';
                    const name = file.split('.')[0].replace(/_/g, ' ');
                    const price = type === 'Keychain' ? 50 : 40;
                    return `<div class="card"><img src="${file}" style="width:100%; aspect-ratio:1/1; object-fit:cover;" onerror="this.src='coming soon1.jpeg'"><div style="padding:16px;"><div style="font-size:11px; color:var(--prim); font-weight:700;">${type}</div><div style="font-weight:700; text-transform:capitalize;">${name}</div><button class="btn-m3" style="margin-top:12px;" onclick="ENGINE.add('${file}','${name}','${type}',${price})">Add R${price}</button></div></div>`;
                }).join('');
                this.update();
                this.syncGoogle();
            },
            syncGoogle() {
                const user = JSON.parse(localStorage.getItem('user'));
                if(user) {
                    document.getElementById('user-display-name').innerText = user.name;
                    document.getElementById('user-anchor').innerHTML = `<img src="${user.picture}" style="width:100%">`;
                }
            },
            add(file, name, type, price) {
                if(!this.cart[name]) this.cart[name] = { file, type, price, qty: 0 };
                this.cart[name].qty++;
                this.update();
            },
            changeQty(name, delta) {
                if(this.cart[name]) {
                    this.cart[name].qty += delta;
                    if(this.cart[name].qty <= 0) delete this.cart[name];
                    this.update();
                }
            },
            update() {
                localStorage.setItem('otaku_cart_v2', JSON.stringify(this.cart));
                let sub = 0, html = '';
                for(let n in this.cart) {
                    const i = this.cart[n]; sub += (i.price * i.qty);
                    html += `<div class="cart-item"><img src="${i.file}" class="cart-img" onerror="this.src='coming soon1.jpeg'"><div style="flex:1;"><div style="font-size:10px; font-weight:700; color:var(--prim);">${i.type}</div><div style="font-weight:700; text-transform:capitalize;">${n}</div><div>R${i.price}</div></div><div style="display:flex; align-items:center; background:rgba(255,255,255,0.05); border-radius:20px; padding:4px; gap:8px;"><button class="qty-btn" style="width:28px; height:28px; border-radius:50%; border:none; background:var(--out); color:white;" onclick="ENGINE.changeQty('${n}',-1)">-</button><span style="font-weight:700; min-width:16px; text-align:center;">${i.qty}</span><button class="qty-btn" style="width:28px; height:28px; border-radius:50%; border:none; background:var(--out); color:white;" onclick="ENGINE.changeQty('${n}',1)">+</button></div></div>`;
                }
                const ship = parseInt(document.querySelector('input[name="paxi"]:checked').value);
                document.getElementById('bag-count').innerText = 'R' + sub;
                document.getElementById('final-total').innerText = 'R' + (sub + ship);
                document.getElementById('cart-list').innerHTML = html || '<p style="text-align:center; padding:40px; color:#888;">Bag is empty</p>';
            },
            checkout() { alert('Google Cloud linking order... âš“'); }
        };

        function handleCredentialResponse(response) {
            const user = JSON.parse(atob(response.credential.split('.')[1]));
            localStorage.setItem('user', JSON.stringify(user));
            location.reload();
        }

        window.onload = () => {
            ENGINE.init();
            google.accounts.id.initialize({ client_id: "919544111369-2hhnhfnsc0hvrgnq1dn8fjc8ca3im7jv.apps.googleusercontent.com", callback: handleCredentialResponse });
            google.accounts.id.renderButton(document.getElementById("google-login-btn"), { theme: "filled_blue", size: "large", shape: "pill" });
        };
    </script>
</body>
</html>

